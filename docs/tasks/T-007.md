# T-007: 相似度算法(省外推荐)

## 目标
实现省外相似区域推荐算法，找出其他省份中与选中区域GDP最接近的行政区域。

## 完成内容

### 1. 相似度算法 (`src/utils/similarity.ts`)
- ✅ 创建 `findSimilarRegions` 函数
- ✅ 支持配置选项：limit, sameLevelOnly, year
- ✅ 算法逻辑实现：
  - 获取目标区域的GDP和层级
  - 筛选候选区域（排除自身、排除同省、同级匹配）
  - 计算GDP差值绝对值
  - 按差值从小到大排序
  - 计算差值百分比
- ✅ 辅助函数：`getDiffColorClass`, `getDiffLabel`

### 2. 相似推荐组件 (`src/components/SimilarRegionsList.tsx`)
- ✅ 列表标题："GDP相近的区域（其他省）"
- ✅ 展示内容：
  - 区域完整路径
  - GDP数值
  - 与当前区域的差值（±X亿元，±X%）
  - 跳转按钮
- ✅ 交互功能：
  - 点击推荐项跳转到该区域详情
  - "加载更多"按钮（结果>5时显示）
- ✅ UI设计：
  - 使用 shadcn Card 组件
  - 差值颜色：绿色(<10%)、黄色(10-30%)、红色(>30%)
  - 响应式列表布局
  - 排名序号、悬停效果

### 3. 集成到结果页 (`src/pages/ResultPage.tsx`)
- ✅ 导入 SimilarRegionsList 组件
- ✅ 在右侧栏替换 T-007 占位符
- ✅ 传入当前 regionCode 和 year
- ✅ 区域切换时自动重新计算

## QA 防线检查

- [x] 防线1: ESLint + TypeScript 无错误
- [x] 防线2: npm run build 成功
- [x] 防线3: 推荐结果合理，计算正确

## 测试结果

### 算法验证
以深圳市(440300)为例：
- 深圳市2023年GDP: 34606.40亿元
- 省外同级（地级市）匹配
- 推荐结果按GDP差值排序

### UI验证
- 相似区域列表正确显示
- 颜色标签按差值百分比正确显示
- 点击跳转功能正常
- 加载更多/收起功能正常

## 文件变更

```
src/
  utils/
    similarity.ts           # 新增：相似度算法
  components/
    SimilarRegionsList.tsx  # 新增：相似区域列表组件
  pages/
    ResultPage.tsx          # 修改：集成SimilarRegionsList
tasks/
  T-007-相似度算法.md       # 新增：任务文档
```

## Git Commit

```
T-007: 相似度算法(省外推荐)

- 实现 findSimilarRegions 算法，支持同级匹配和省外筛选
- 创建 SimilarRegionsList 组件，支持响应式布局和交互
- 集成到 ResultPage 右侧栏
- 通过 ESLint + TypeScript + Build 检查
```
